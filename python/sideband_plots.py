import matplotlib
matplotlib.use('PS')

import matplotlib.pyplot as plt
from matplotlib.backends.backend_pdf import PdfPages

def plot(sideband, nominal, x_range, fit, fit_err, outputname, titel='', signal=None, sideband_sigma =None, nominal_sigma=None):
    pp = PdfPages(outputname)
    plt.clf()
    #plt.semilogy()
    plt.yscale('log', nonposy='clip')
    ax=plt.gca()
    ax.set_ylim([.01,10])
    ax.set_xlim([650,1850])

    plt.title(titel, fontsize=10)# , loc='right')"CMS $\it{Preliminary}$       35.9 fb$^{-1}$ (13 TeV)"
    plt.plot(x_range, nominal, label="Exp $95\%$ CL nominal" , color ='red',linestyle='dotted')#,color = exp_LH.bands[0][2])
    plt.plot(x_range, sideband, label="Exp $95\%$ CL sideband" , color ='blue',linestyle='dotted')#,color = exp_LH.bands[0][2])
   
    
    if signal:
        plt.plot(x_range, signal, label="signal cross section" , color ='black',linestyle='dotted')#,color = exp_LH.bands[0][2])

    if sideband_sigma:
        plt.fill_between(x_range, sideband_sigma[0] ,  sideband_sigma[1],
                         alpha=0.3, facecolor='yellow', edgecolor='yellow',
                         linewidth=0, label="$\pm$ 1 std. deviation sideband")
    if nominal_sigma:
        plt.fill_between(x_range, nominal_sigma[0] ,  nominal_sigma[1],
                         alpha=0.6, facecolor='yellow', edgecolor='yellow',
                         linewidth=0, label="$\pm$ 1 std. deviation nominal")    
    ax.errorbar(x_range, fit, yerr=fit_err, label="fitted cross section" , color ='green',linestyle='dotted')#,color = exp_LH.bands[0][2])
    #ax.set_yscale('symlog')

    plt.xlabel('VLQ mass (GeV)')
    plt.ylabel(r'$\mathbf{\sigma \times}$  BR(VLQ$\mathbf{\rightarrow}$tW) (pb)')
    plt.legend(loc="upper center",prop={'size':12},frameon=False)
    plt.savefig(pp, format='pdf')
    pp.close()

    

x_range =  [700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800]

cross_sec = [4.339,3.016,2.219,1.653,1.192,0.896,0.679,0.529,0.415,0.319,0.248,0.195]
cross_sec = [x*0.5 for x in cross_sec]

mu_sideband = [8.23945391455565, 1.7681614787775854, 0.7085747047907235, 0.4243282186700291, 0.30645593838746843, 0.2140105344251929, 0.19957375287650828, 0.17008126412422414, 0.16912607638835647, 0.14933845970550005, 0.1645098043979184, 0.15112214898751258] 
mu_nominal  = [1.1233652099362008, 0.7942662255487793, 0.4551803258801174, 0.2900797696586372, 0.1909093039178538, 0.15772178146213844, 0.13126318478233107, 0.1084248327836018, 0.08302705101571176, 0.07655797478046021, 0.067503097225388, 0.061709268222509925] 

mu_sideband_sigma = [[3.840808389796943, 1.0178084715976692, 0.4677445834643047, 0.26270287038228685, 0.20767862572042708, 0.13148843576745262, 0.1271861390191178, 0.10016235263171819, 0.10445236697151954, 0.10598021075601902, 0.10627152790985075, 0.10557438225314827], [25.46421633489758, 3.827844375067385, 1.2346660831955338, 0.6148369105994494, 0.5246501597720464, 0.36351129093753787, 0.3106405896750166, 0.261812389987567, 0.25218122314783076, 0.23322569582444472, 0.25618679913164133, 0.22087332924080239]]


# full cross section
mu_fit = [4.70163203306216, 0.6833321110571512, 0.8580224290972931, 0.9331379568819134, 0.5566413435881054, 0.40238817667419985, 0.2329946205476199, 0.1495949023521697, 0.13397942940904906, 0.09543651188237916, 0.10351753991810315, 0.09345450361774743]
mu_err = [2.482268353555416, 1.204178657886413, 0.4664117116499556, 0.26308022017795085, 0.15948257182224895, 0.10483114758300131, 0.09320189363300559, 0.07671608940726185, 0.06459312642883051, 0.054581539793573684, 0.05293140386969873, 0.047856770911750425]


mu_title= "Muon channel        35.9 fb$^{-1}$ (13 TeV)"
plot(mu_sideband,mu_nominal,x_range,mu_fit,mu_err,'muon_sideband.pdf',mu_title,cross_sec,mu_sideband_sigma)
"""
#nominal fit
mu_fit =
mu_err = 


mu_nominal_sigma = [[0.8614263091194461, 0.4086211864220742, 0.24839604946166724, 0.16221846888570093, 0.11709247816721824, 0.07360848715172176, 0.0680026963890732, 0.06391904162978986, 0.05229723498561897, 0.04342970057976363, 0.03914580927389597, 0.036270513179945486], [2.646239153520158, 1.0403649644753659, 0.5612435165419256, 0.3920951170600231, 0.2778508568048414, 0.18010766361507086, 0.17869906545082834, 0.14419266085192786, 0.112457211656947, 0.1050476166672599, 0.09612064234837539, 0.08285407196906171]]

plot(mu_sideband,mu_nominal,x_range,mu_fit,mu_err,'muon_nom.pdf',mu_title,cross_sec,None,mu_nominal_sigma)
"""
ele_sideband = [5.206827244180406, 1.7669836107214503, 0.7324653787948135, 0.4615856010425115, 0.30170835826560927, 0.25255292765298937, 0.17920251303622065, 0.13438552463340375, 0.13002888938381407, 0.11762343258657101, 0.10000920568090493, 0.10149488929204038]
#ele_sideband =[46.18817793226995, 3.22347430497846, 0.9415871551649556, 0.6875608507331283, 0.4165947316547385, 0.3714358656675981, 0.29913749829549763, 0.2557649097096927, 0.24054160758140272, 0.24289118587823083, 0.23723238641697347, 0.23831480494833096]
ele_nominal  = [1.1233652099362008, 0.7942662255487793, 0.4551803258801174, 0.2900797696586372, 0.1909093039178538, 0.15772178146213844, 0.13126318478233107, 0.1084248327836018, 0.08302705101571176, 0.07655797478046021, 0.067503097225388, 0.061709268222509925]

#ele_sideband_sigma =[[17.52561454161678, 1.6381775609117561, 0.5306871010290903, 0.39849802192773914, 0.2531965883587288, 0.23615502372706623, 0.1855200819571824, 0.17333446010770542, 0.13939093295609636, 0.14732225591811385, 0.1432905359081674, 0.15418634103972645], [92.84833247884927, 8.428584442054891, 1.7059472150264061, 1.2434876146759402, 0.6651992870841434, 0.6061546164910712, 0.48402420234248283, 0.4241644455650142, 0.38156783203245004, 0.36695510116106106, 0.36524111808718035, 0.40225372974760765]]
ele_sideband_sigma =[[2.463157308101141, 1.0812109609826765, 0.45661433646777194, 0.2919743308518533, 0.17519662098433195, 0.14835777113219592, 0.11803749395147753, 0.08719242807667117, 0.08601896265231586, 0.07121063184013209, 0.0638810240841384, 0.06729686918013145], [16.803462705276267, 3.4979140027108087, 1.377908042868052, 0.6955871417456553, 0.4476326345851547, 0.4475870941036851, 0.3149238342727254, 0.20977786278096566, 0.19706279957177458, 0.18635509017833382, 0.14329226861937852, 0.1545497195253373]]

    
ele_fit = [0.7033582902762474, 1.5327388126419428, 1.2784966134193114, 0.43873218815226783, 0.5344448043184049, 0.6755752689511354, 0.45148636502381856, 0.3412267864989859, 0.22128591565718223, 0.14753333856564707, 0.12006516028938928, 0.07327681964972198]
ele_err = [1.4566197159297256, 1.178353613259768, 0.5483694391545382, 0.3445050808419255, 0.1879203639145284, 0.1605815814485185, 0.11986594843944628, 0.09138741745556964, 0.07690473703939935, 0.07139781280879232, 0.06018710203934626, 0.058553465961844894]


#ele_fit =[0.2623161345998744, 0.7806551391507284, 0.8383482175077344, 0.11111612974166712, 0.310677937590977, 0.5111857821531103, 0.326502131348113, 0.2469164609432841, 0.14820601416596105, 0.09213219045135175, 0.07537200365617873, 0.03607160035943699]
#ele_err =[0.5747622887015547, 1.30432127024635, 0.5506064899543184, 0.3296656297614037, 0.18110327340355012, 0.15436861958217102, 0.11813039855427901, 0.08873948246587791, 0.07573515885620508, 0.0704457360817893, 0.059319952428650846, 0.05758664446666323]


ele_title= "Electron channel        35.9 fb$^{-1}$ (13 TeV)"
plot(ele_sideband, ele_nominal,x_range,ele_fit,ele_err,'electron_sideband.pdf',ele_title,cross_sec,ele_sideband_sigma)
"""
#nominal fit
ele_fit =
ele_err = 

ele_nominal_sigma =[[0.7596134151004795, 0.46554490762340484, 0.3101852490775735, 0.18560331613615208, 0.1248201617167004, 0.11050586390265989, 0.08475536601178946, 0.07094922173847919, 0.053256889236386135, 0.0498662880989448, 0.04071360004534006, 0.04203644116089132], [1.9240729680055633, 1.3297148303683144, 0.7372402098889661, 0.4559287250488171, 0.2861541015991873, 0.2519276747560218, 0.20464180893850561, 0.1687996360582348, 0.13588295780980938, 0.11516684582191711, 0.10262174644434659, 0.08740414620094408]]

plot(ele_sideband, ele_nominal,x_range,ele_fit,ele_err,'electron_nom.pdf',ele_title,cross_sec,None,ele_nominal_sigma)
"""
